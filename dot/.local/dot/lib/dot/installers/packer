#!/usr/bin/env zsh
##################################
# Install git locally on $DOT_PATH
##################################

autoload dot_printf_install
autoload dot_printf_run
autoload dot_printf_clean

#
# Essential variables
#
packer_version=${1:-0.8.6}
packer_basename=packer_${packer_version}_linux_amd64
packer_tarball=${packer_basename}.zip
packer_url=https://dl.bintray.com/mitchellh/packer/${packer_tarball}


#
# Get the actual git source tarball
#
dot_printf_run "Getting packer tarball"
cd /tmp
wget $packer_url -O $packer_tarball && \
    unzip $packer_tarball -d $packer_basename && \
    rm -f $packer_tarball || exit 1

#
# Install packer
#
dot_printf_install "Packer ${packer_version}"
cd $packer_basename && mv * $DOT_PATH/bin || exit 1

#
# Remove everything
#
dot_printf_clean everything
cd /tmp && rm -rf $packer_basename
