#!/usr/bin/env zsh
#########################################
# syncd: watch for changes in dotsync directory
# and dot sync if necessary
#########################################
dot_btsync_dir=~/.dotsync
inotify_events="create,delete,move,delete_self,move_self"

# Any changes inside btsync directory will be stowed
# into the home directory
while inotifywait --syslog @.sync -r \
    -e $inotify_events $dot_btsync_dir > /dev/null
do
    for dir in $dot_btsync_dir/* ; do
        dot sync $(basename $dir) &> /dev/null;
    done
    # send the actual notification
    if [[ ! -z "$DISPLAY" ]]; then
        notify-send --urgency=low "dotsync" "All directories synced and stowed!"
    fi
    unset dir
done
