#!/usr/bin/env zsh
##################################
# Install git locally on $DOT_PATH
##################################

. $ZSH_HOME/lib/printf

#
# Essential variables
#
GIT_VERSION=2.4.0
GIT_BASENAME=git-$GIT_VERSION
GIT_TARBALL=$GIT_BASENAME.tar.xz
GIT_URL=https://www.kernel.org/pub/software/scm/git/$GIT_TARBALL

cd /tmp

#
# Get the actual git source tarball
#
printf_run "Getting git tarball"
wget $GIT_URL -O $GIT_TARBALL && tar xf $GIT_TARBALL
rm -f $GIT_TARBALL

#
# Get dependencies
#
printf_install "Git dependencies"
sudo apt-get update && sudo apt-get install -y libcurl4-gnutls-dev \
  libexpat1-dev gettext libz-dev libssl-dev

#
# Compile it
#
printf_install "Compile & install git-scm"
cd $GIT_BASENAME && ./configure --prefix=$DOT_PATH && make install

#
# Remove everything
#
printf_clean everything
cd /tmp && rm -rf $GIT_BASENAME
