#!/usr/bin/env zsh
##################################
# Install tmux + plugins
##################################

autoload dot_printf_install

# The actual variables for tmux compilation
tmux_git=https://github.com/tmux/tmux.git
tmux_src=~/Projects/tmux
tmux_deps=(tmux)
tmux_opts=(\
          --prefix=$DOT_PATH \
          )

# Vundle-related variables
tpm_git=https://github.com/tmux-plugins/tpm
tpm_src=~/.tmux/plugins/tpm

dot_printf_install "tmux dependencies"

# First of all, we need some dependencies
sudo apt-get build-dep -y "${tmux_deps[@]}"

# Now, we do the thing
dot_printf_install "tmux"

# Clone/pull the repo
if [ ! -d $tmux_src ]; then
    git clone $tmux_git $tmux_src
else
    git -C $tmux_src pull
fi

# Compile and install tmux
cd $tmux_src
[ ! -x configure ] && ./autogen.sh
./configure "${tmux_opts[@]}" && make clean  && make && make install

dot_printf_install "tmux plugin manager"

# Set up tpm
if [ ! -d $tpm_src ]; then
    git clone $tpm_git $tpm_src
else
    git -C $tpm_src pull
fi
